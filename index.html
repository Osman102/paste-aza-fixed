<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PasteAZA - Simple Pastebin</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/prismjs@1.29.0/themes/prism-tomorrow.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }
    .header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    .main-content {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 30px;
      align-items: start;
    }
    .editor-section {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .paste-preview {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      height: fit-content;
    }
    .editor-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #444;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .language-selector {
      padding: 8px 12px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      background: white;
      font-size: 14px;
      min-width: 120px;
    }
    .editor {
      width: 100%;
      min-height: 400px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Fira Code', 'Monaco', monospace;
      font-size: 15px;
      line-height: 1.6;
      resize: vertical;
      background: #fafbfc;
      color: #24292e;
      outline: none;
      transition: all 0.2s ease;
    }
    .editor:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .create-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    .create-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
    }
    .create-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .paste-card {
      background: #1a1a2e;
      color: white;
      border-radius: 16px;
      padding: 25px;
      position: relative;
      overflow: hidden;
    }
    .paste-id {
      font-family: monospace;
      font-size: 24px;
      font-weight: 700;
      background: rgba(255,255,255,0.1);
      padding: 15px 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
      letter-spacing: 2px;
      backdrop-filter: blur(10px);
    }
    .paste-url {
      background: rgba(255,255,255,0.1);
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      word-break: break-all;
      margin-bottom: 20px;
      text-align: center;
    }
    .copy-btn {
      background: #00d4aa;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      width: 100%;
      margin-bottom: 15px;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.8;
      margin-top: 15px;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .header h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // Debounce hook
    function useDebounce(value, delay) {
      const [debouncedValue, setDebouncedValue] = useState(value);
      useEffect(() => {
        const handler = setTimeout(() => {
          setDebouncedValue(value);
        }, delay);
        return () => {
          clearTimeout(handler);
        };
      }, [value, delay]);
      return debouncedValue;
    }

    // Main App
    function App() {
      const [content, setContent] = useState('// Start typing your code here...\n// Supports 100+ languages');
      const [language, setLanguage] = useState('javascript');
      const [title, setTitle] = useState('');
      const [pasteId, setPasteId] = useState(null);
      const [loading, setLoading] = useState(false);
      const [pasteData, setPasteData] = useState(null);
      const editorRef = useRef(null);

      const debouncedContent = useDebounce(content, 500);

      // Load paste if ID in URL
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        if (id) {
          setPasteId(id);
          loadPaste(id);
        }
      }, []);

      const loadPaste = async (id) => {
        try {
          setLoading(true);
          const response = await fetch(`/api/paste/${id}`);
          const data = await response.json();
          if (data.error) throw new Error(data.error);
          
          setContent(data.content);
          setLanguage(data.language || 'plaintext');
          setTitle(data.title || '');
          setPasteData(data);
        } catch (error) {
          alert('Paste not found');
          window.history.replaceState({}, document.title, '/');
        } finally {
          setLoading(false);
        }
      };

      const createPaste = async () => {
        if (!content.trim()) return;
        
        try {
          setLoading(true);
          const response = await fetch('/api/paste', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content, language, title })
          });
          
          const result = await response.json();
          if (result.error) throw new Error(result.error);
          
          setPasteId(result.id);
          const url = `${window.location.origin}${result.url}`;
          window.history.replaceState({}, '', `?id=${result.id}`);
          
          // Copy to clipboard
          navigator.clipboard.writeText(url);
          
          // Auto-scroll to preview
          setTimeout(() => {
            document.querySelector('.paste-preview')?.scrollIntoView({ behavior: 'smooth' });
          }, 100);
          
        } catch (error) {
          alert('Error creating paste: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const copyPasteUrl = () => {
        const url = `${window.location.origin}/?id=${pasteId}`;
        navigator.clipboard.writeText(url);
        // Visual feedback could be added here
      };

      return (
        <div className="container">
          <div className="header">
            <h1>PasteAZA</h1>
            <p>Simple. Fast. Beautiful. Share code instantly.</p>
          </div>
          
          <div className="main-content">
            <div className="editor-section">
              <div className="editor-title">
                Create New Paste
                <select 
                  className="language-selector"
                  value={language}
                  onChange={(e) => setLanguage(e.target.value)}
                >
                  <option value="plaintext">Plain Text</option>
                  <option value="javascript">JavaScript</option>
                  <option value="python">Python</option>
                  <option value="java">Java</option>
                  <option value="cpp">C++</option>
                  <option value="csharp">C#</option>
                  <option value="go">Go</option>
                  <option value="rust">Rust</option>
                  <option value="php">PHP</option>
                  <option value="ruby">Ruby</option>
                  <option value="html">HTML</option>
                  <option value="css">CSS</option>
                  <option value="json">JSON</option>
                  <option value="bash">Bash</option>
                  <option value="sql">SQL</option>
                </select>
              </div>
              
              <textarea
                ref={editorRef}
                className="editor"
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder="Start typing your code, text, or anything..."
                rows="20"
              />
              
              <button 
                className="create-btn"
                onClick={createPaste}
                disabled={loading || !content.trim()}
              >
                {loading ? 'Creating...' : pasteId ? 'Update Paste' : 'Create Paste'}
              </button>
            </div>
            
            <div className="paste-preview">
              {pasteId ? (
                <div className="paste-card">
                  <div className="paste-id">{pasteId.toUpperCase()}</div>
                  <div className="paste-url">
                    {window.location.origin}/?id={pasteId}
                  </div>
                  <button className="copy-btn" onClick={copyPasteUrl}>
                    ðŸ“‹ Copy Link
                  </button>
                  {pasteData && (
                    <div className="stats">
                      <span>Views: {pasteData.views || 0}</span>
                      <span>{new Date(pasteData.createdAt).toLocaleString()}</span>
                    </div>
                  )}
                </div>
              ) : (
                <div className="loading">
                  <div>Paste preview will appear here</div>
                  <div style={{fontSize: '12px', marginTop: '10px', opacity: '0.7'}}>
                    Create a paste to get your shareable link
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
